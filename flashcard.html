<!DOCTYPE html>
<html lang="en,sat">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Araq-Boeha</title>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.0/dist/jszip.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      margin: 20px;
      text-align: center;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    #questionBox, #answerBox {
      margin: 20px 0;
      padding: 20px;
      border-radius: 12px;
    }
    #questionBox {
      background: #eef6fb;
    }
    #answerBox {
      background: #d4edda;
      display: none;
    }
    button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .easy { background: #4CAF50; color: white; }
    .hard { background: #f44336; color: white; }
    .show { background: #2196F3; color: white; }
    .progress {
      margin-top: 10px;
      font-weight: bold;
    }
    .timer {
      margin-top: 5px;
      color: #555;
    }
  </style>
</head>
<body>

<div class="container">
  <h1>Flashcard Qana</h1>
  <input type="file" id="zipFile" accept=".zip"><br><br>

  <div id="questionBox">E̠ho̠p̕ lạgit̕ mit̕ṭen ZIP file upload me!</div>
  <div id="answerBox"></div>

  <button id="showAnswer" class="show">Jo̠bab Ñelme</button>
  <button id="easy" class="easy">Alga</button>
  <button id="hard" class="hard">Haron</button>

  <div class="progress" id="progress"></div>
  <div class="timer" id="timer">Paṛao aqan O̠kte̠: 00:00</div>
</div>

<script>
  let questions = [], answers = [], index = 0, hardList = [];
  let originalPairs = [];
  let startTime, timerInterval;

  const qBox = document.getElementById('questionBox');
  const aBox = document.getElementById('answerBox');
  const showBtn = document.getElementById('showAnswer');
  const easyBtn = document.getElementById('easy');
  const hardBtn = document.getElementById('hard');
  const progress = document.getElementById('progress');
  const timerDisplay = document.getElementById('timer');

  function startTimer() {
    startTime = Date.now();
    clearInterval(timerInterval);
    timerInterval = setInterval(() => {
      const elapsed = Date.now() - startTime;
      const minutes = Math.floor(elapsed / 60000);
      const seconds = Math.floor((elapsed % 60000) / 1000);
      timerDisplay.textContent = `Elapsed Time: ${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
    }, 1000);
  }

  function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
  }

  function updateProgress() {
    progress.textContent = `Progress: ${index + 1} / ${questions.length}`;
  }

  function showQuestion() {
    if (index >= questions.length) {
      if (hardList.length > 0) {
        questions = hardList.map(p => p.question);
        answers = hardList.map(p => p.answer);
        hardList = [];
        index = 0;
        alert("Ñitoq haronaq qukli ñelme!");
        startTimer();
        showQuestion();
      } else {
        clearInterval(timerInterval);
        if (confirm("Joto qukli cabaina. Cheq arhoem ehoṕa?")) {
          restartSession();
        }
        return;
      }
    }
    qBox.textContent = questions[index];
    aBox.style.display = 'none';
    aBox.textContent = "Answer: " + answers[index];
    updateProgress();
  }

  function restartSession() {
    const pairs = [...originalPairs];
    shuffle(pairs);
    questions = pairs.map(p => p.question);
    answers = pairs.map(p => p.answer);
    index = 0;
    hardList = [];
    startTimer();
    showQuestion();
  }

  showBtn.onclick = () => {
    aBox.style.display = 'block';
  };

  easyBtn.onclick = () => {
    index++;
    showQuestion();
  };

  hardBtn.onclick = () => {
    hardList.push({ question: questions[index], answer: answers[index] });
    index++;
    showQuestion();
  };

  document.getElementById('zipFile').addEventListener('change', async (event) => {
    const file = event.target.files[0];
    if (!file) return;

    const zip = await JSZip.loadAsync(file);
    const qText = await zip.file("questions.txt").async("string");
    const aText = await zip.file("answers.txt").async("string");

    const qArray = qText.trim().split("\n");
    const aArray = aText.trim().split("\n");

    const pairs = qArray.map((q, i) => ({ question: q, answer: aArray[i] }));

    shuffle(pairs);
    originalPairs = [...pairs];

    questions = pairs.map(p => p.question);
    answers = pairs.map(p => p.answer);

    index = 0;
    startTimer();
    showQuestion();
  });
</script>

</body>
</html>
